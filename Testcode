# This is a Bitbucket Pipelines configuration to validate and deploy Salesforce metadata.
# -----
# Define your pipeline.
pipelines:
  branches:
    # Define the pipeline for the master branch.
    master:
      - step:
          name: Install Salesforce CLI
          image: node:14
          caches:
            - node
          script:
            # Install Salesforce CLI
            - npm install -g sfdx-cli

      - step:
          name: Authenticate with Salesforce Org
          image: sfdxci/sfdx
          caches:
            - sfdx
          script:
            # Authenticate with Salesforce org using a JWT token
            - sfdx force:auth:jwt:grant --clientid $SFDC_CLIENT_ID --jwtkeyfile JWT/server.key --username $SFDC_USERNAME --setdefaultdevhubusername --setalias devhub

      - step:
          name: Validate Salesforce Metadata
          image: sfdxci/sfdx
          caches:
            - sfdx
          script:
            # Validate metadata against the Salesforce org
            - sfdx force:source:validate -p path/to/your/source --targetusername $SFDC_USERNAME

      - step:
          name: Deploy to Salesforce Org
          image: sfdxci/sfdx
          caches:
            - sfdx
          script:
            # Deploy metadata to Salesforce org
            - sfdx force:source:deploy -p path/to/your/source --targetusername $SFDC_USERNAME
