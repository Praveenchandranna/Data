name: Salesforce Code Analysis

on:
  push:
    branches:
      - main  # Adjust branch name if needed

jobs:
  analyze_code:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Run Salesforce Code Analyzer
        run: |
          sfdx force:source:lint --files force-app/main/default/* --format json > analysis_results.json
          
      - name: Convert JSON to YAML
        uses: json2yaml/json2yaml-action@v1
        with:
          src: analysis_results.json
          dest: analysis_results.yaml

      - name: Store Analysis Results
        run: |
          mkdir -p analysis_results
          mv analysis_results.yaml analysis_results/analysis_results.yaml
          echo "::set-output name=analysis_file_path::analysis_results/analysis_results.yaml"

      - name: Commit Analysis Results
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update Salesforce code analysis results"
          file_pattern: "analysis_results/analysis_results.yaml"
          branch: ${{ github.ref }}

      - name: Push Changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}





________
name: Salesforce Code Analysis

on:
  push:
    branches:
      - main  # Adjust branch name if needed

jobs:
  analyze_code:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install Salesforce CLI
        run: |
          wget https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz
          mkdir sfdx-cli
          tar xJf sfdx-linux-amd64.tar.xz -C sfdx-cli --strip-components 1
          sudo ./sfdx-cli/install

      - name: Authenticate with Salesforce Org
        run: |
          sfdx auth:jwt:grant --clientid ${{ secrets.SALESFORCE_CLIENT_ID }} --username ${{ secrets.SALESFORCE_USERNAME }} --jwtkeyfile ./server.key --instanceurl ${{ secrets.SALESFORCE_INSTANCE_URL }} --setdefaultdevhubusername -a devhub

      - name: Run Salesforce Code Analyzer
        run: |
          sfdx force:source:lint --files force-app/main/default/* --format json > analysis_results.json

      - name: Convert JSON to YAML
        uses: json2yaml/json2yaml-action@v1
        with:
          src: analysis_results.json
          dest: analysis_results.yaml

      - name: Store Analysis Results
        run: |
          mkdir -p analysis_results
          mv analysis_results.yaml analysis_results/analysis_results.yaml
          echo "::set-output name=analysis_file_path::analysis_results/analysis_results.yaml"

      - name: Commit Analysis Results
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update Salesforce code analysis results"
          file_pattern: "analysis_results/analysis_results.yaml"
          branch: ${{ github.ref }}

      - name: Push Changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
_&&&&
name: Salesforce Code Analysis

on:
  push:
    branches:
      - main  # Adjust branch name if needed

jobs:
  analyze_code:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install Salesforce CLI
        run: |
          wget https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz
          mkdir sfdx-cli
          tar xJf sfdx-linux-amd64.tar.xz -C sfdx-cli --strip-components 1
          sudo ./sfdx-cli/install

      - name: Authenticate with Salesforce Org
        run: |
          sfdx auth:jwt:grant --clientid ${{ secrets.SALESFORCE_CLIENT_ID }} --username ${{ secrets.SALESFORCE_USERNAME }} --jwtkeyfile ./server.key --instanceurl ${{ secrets.SALESFORCE_INSTANCE_URL }} --setdefaultdevhubusername -a devhub

      - name: Run Salesforce Code Analyzer
        run: |
          sfdx force:source:lint --files force-app/main/default/* --format json > analysis_results.json

      - name: Convert JSON to YAML
        run: |
          apt-get update && apt-get install -y jq python3-pip
          pip3 install yq
          jq . analysis_results.json | yq eval -P - > analysis_results.yaml

      - name: Store Analysis Results
        run: |
          mkdir -p analysis_results
          mv analysis_results.yaml analysis_results/analysis_results.yaml
          echo "::set-output name=analysis_file_path::analysis_results/analysis_results.yaml"

      - name: Commit Analysis Results
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update Salesforce code analysis results"
          file_pattern: "analysis_results/analysis_results.yaml"
          branch: ${{ github.ref }}

      - name: Push Changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}


pppppppp




name: Salesforce Code Analysis

on:
  push:
    branches:
      - main  # Adjust branch name if needed

jobs:
  analyze_code:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install Salesforce CLI
        run: |
          wget https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz
          mkdir sfdx-cli
          tar xJf sfdx-linux-amd64.tar.xz -C sfdx-cli --strip-components 1
          sudo ./sfdx-cli/install

      - name: Authenticate with Salesforce Org
        run: |
          sfdx auth:jwt:grant --clientid ${{ secrets.SALESFORCE_CLIENT_ID }} --username ${{ secrets.SALESFORCE_USERNAME }} --jwtkeyfile ./server.key --instanceurl ${{ secrets.SALESFORCE_INSTANCE_URL }} --setdefaultdevhubusername -a devhub

      - name: Run Salesforce Code Analyzer
        run: |
          sfdx force:source:lint --files force-app/main/default/* --format json > analysis_results.json

      - name: Convert JSON to YAML
        run: |
          apt-get update && apt-get install -y python3
          python3 -c 'import json, sys, yaml; yaml.safe_dump(json.load(sys.stdin), sys.stdout, default_flow_style=False)' < analysis_results.json > analysis_results.yaml

      - name: Store Analysis Results
        run: |
          mkdir -p analysis_results
          mv analysis_results.yaml analysis_results/analysis_results.yaml
          echo "::set-output name=analysis_file_path::analysis_results/analysis_results.yaml"

      - name: Commit Analysis Results
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update Salesforce code analysis results"
          file_pattern: "analysis_results/analysis_results.yaml"
          branch: ${{ github.ref }}

      - name: Push Changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
         +++++


            name: VFS Validation Pipeline

on:
  workflow_dispatch:
    inputs:
      Feature_Branch:
        type: String
        description: Please Enter Branch To validate in Environment.
        required: true
      environment:
        type: choice
        description: Please Select The Validation Environment.
        options:
          - VFS QA
          - VFS UAT
        default: "VFS QA"
        required: true
      testlevel:
        type: choice
        description: Select Test class Run Type.
        options:
          - NoTestRun
          - RunLocalTests
          - RunSpecifiedTests
          - RunAllTestsInOrg
        default: "RunSpecifiedTests"
        required: true
      specifiedclass:
        type: String
        description: Please Enter Test Class Names with Comma Separated.

jobs:
  validate_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install Salesforce CLI
        run: |
          npm install -g @salesforce/cli@latest
          sfdx --version

      - name: Generate JWT Key
        shell: bash
        run: echo "${{ secrets.SALESFORCE_JWT_SECRET_KEY }}" > server.key

      - name: Authorize Org
        run: |
          sfdx force:auth:jwt:grant --client-id=${{ secrets.SALESFORCE_CONSUMER_KEY_${{ github.event.inputs.environment | upper }} }} --jwt-key-file=server.key --username=${{ secrets.SFDX_AUTH_${{ github.event.inputs.environment | upper }}_USERNAME }} --set-default-dev-hub

      - name: Run Salesforce Code Analyzer
        run: sfdx force:source:lint --files force-app/main/default/* --format json > analysis_results.json

      - name: Store Analysis Results
        run: |
          mkdir -p analysis_results
          mv analysis_results.json analysis_results/analysis_results.json
          echo "::set-output name=analysis_file_path::analysis_results/analysis_results.json"

      - name: Deploy to Org
        if: ${{ github.event.inputs.environment == 'VFS UAT' }}
        run: |
          sfdx force:source:deploy --checkonly -w 500 -x manifest/${{ github.event.inputs.Feature_Branch }}_package.xml --targetusername ${{ secrets.SFDX_AUTH_VFS_UAT_USERNAME }} --testlevel ${{ github.event.inputs.testlevel }}${{ github.event.inputs.testlevel == 'RunSpecifiedTests' ? ' --runtests ' + github.event.inputs.specifiedclass : '' }}

      - name: Deploy to Org
        if: ${{ github.event.inputs.environment == 'VFS QA' }}
        run: |
          sfdx force:source:deploy --checkonly -w 500 -x manifest/${{ github.event.inputs.Feature_Branch }}_package.xml --targetusername ${{ secrets.SFDX_AUTH_VFS_QA_USERNAME }} --testlevel ${{ github.event.inputs.testlevel }}${{ github.event.inputs.testlevel == 'RunSpecifiedTests' ? ' --runtests ' + github.event.inputs.specifiedclass : '' }}
            

